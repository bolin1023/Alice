<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alice Script - Part 1 (Final Layout)</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #fff5e6;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }
        
        /* è¨­å®šå€åŸŸå®¹å™¨ */
        .settings-bar {
            position: absolute;
            top: 15px;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 20px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column; /* å‚ç›´å †ç–Š */
            gap: 5px; /* å…©åˆ—ä¹‹é–“çš„é–“è· */
            align-items: flex-start; /* è®“å…§å®¹é å·¦å°é½Š */
            justify-content: center;
            z-index: 10;
            width: 90%;
            max-width: 500px; /* ç¨å¾®ç¸®å°ä»¥é…åˆå…©åˆ— */
        }
        
        /* æ¯ä¸€åˆ—è¨­å®šçš„æ¨£å¼ */
        .setting-row { 
            display: flex;
            align-items: center;
            width: 100%;
            padding: 5px 0;
        }

        label {
            margin-right: 5px;
            font-weight: bold;
            font-size: 0.9rem;
            min-width: 60px; /* ç¢ºä¿æ¨™ç±¤å°é½Š */
        }

        select {
            font-size: 1rem;
            padding: 5px;
            border-radius: 5px;
            border: 1px solid #ccc;
            flex-grow: 1; /* è®“é¸å–®ä½”æ»¿å‰©é¤˜ç©ºé–“ */
        }

        #stage {
            width: 90%;
            max-width: 600px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            padding: 30px;
            text-align: center;
            position: relative;
            min-height: 450px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: border-color 0.5s;
            margin-top: 100px; /* é¨°å‡ºè¶³å¤ ç©ºé–“çµ¦å…©åˆ—è¨­å®šå€ */
        }
        
        /* [ä¿æŒå…¶ä»–æ¨£å¼ä¸è®Š] */
        #scene-title {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 5px;
            font-weight: bold;
        }
        #character-img {
            font-size: 80px;
            margin: 10px 0;
            animation: bounce 2s infinite;
        }
        #character-name {
            font-size: 1.5rem;
            color: #d63384;
            font-weight: bold;
            margin-bottom: 10px;
        }
        #dialogue {
            font-size: 1.4rem;
            line-height: 1.5;
            color: #333;
            min-height: 100px;
            margin-bottom: 20px;
        }
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr 2fr; 
            gap: 10px;
            margin-top: auto;
        }
        button {
            padding: 15px 10px;
            font-size: 1rem;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: transform 0.1s;
            font-weight: bold;
        }
        button:active { transform: scale(0.95); }
        
        #btn-prev { background-color: #e0e0e0; color: #333; }
        #btn-replay { background-color: #2196F3; color: white; } 
        #btn-next { background-color: #FF9800; color: white; font-size: 1.2rem; }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* Scene Themes */
        .scene-1 { border-top: 10px solid #8bc34a; }
        .scene-2 { border-top: 10px solid #e91e63; }
        .scene-3 { border-top: 10px solid #673ab7; }
        .scene-4 { border-top: 10px solid #f44336; }
    </style>
</head>
<body>

<div class="settings-bar">
    <div class="setting-row">
        <label for="voiceSelect">ğŸ—£ï¸ Voice:</label>
        <select id="voiceSelect">
            <option value="">Loading...</option>
        </select>
    </div>
    
    <div class="setting-row">
        <label for="rateSelect">â±ï¸ Speed:</label>
        <select id="rateSelect">
            <option value="0.9">Normal (æ­£å¸¸)</option>
            <option value="0.7">Slow (æ…¢)</option>
            <option value="0.5" selected>Slower (æ›´æ…¢)</option>
        </select>
    </div>
</div>

<div id="stage" class="scene-1">
    <div id="scene-title"> </div>
    <div id="character-img">ğŸ‘±â€â™€ï¸</div>
    <div id="character-name">Alice in Wonderland</div>
    <div id="dialogue">Select Voice & Speed above, then click "Next"!</div>
    
    <div class="controls">
        <button id="btn-prev" onclick="prevLine()">Back</button>
        <button id="btn-replay" onclick="replayLine()">Replay ğŸ”„</button>
        <button id="btn-next" onclick="nextLine()">Next â–¶</button>
    </div>
</div>

<script>
    // åŠ‡æœ¬è³‡æ–™åº« - Part 1
    const scriptData = [
        // --- Scene 1: The Garden ---
        { s: 1, r: "Narrator", e: "ğŸ“–", t: "Alice is bored in the garden." },
        { s: 1, r: "Alice", e: "ğŸ‘±â€â™€ï¸", t: "I'm so bored! What can I do?" },
        { s: 1, r: "Rabbit", e: "ğŸ°", t: "Oh dear! I am late! Are you coming?" },
        { s: 1, r: "Alice", e: "ğŸ‘±â€â™€ï¸", t: "Me? Wait! Where are you going?" },
        { s: 1, r: "Rabbit", e: "ğŸ°", t: "Follow me! Hurry!" },
        { s: 1, r: "Alice", e: "ğŸ‘±â€â™€ï¸", t: "Hey ~ wait!" },
        { s: 1, r: "Cat", e: "ğŸ˜¼", t: "Hello! Are you chasing the rabbit?" },
        { s: 1, r: "Alice", e: "ğŸ‘±â€â™€ï¸", t: "Yes! Can you help me?" },
        { s: 1, r: "Cat", e: "ğŸ˜¼", t: "Maybe! I like fun." },
        { s: 1, r: "Hatter", e: "ğŸ©", t: "Who is late? Tea party is ready!" },
        { s: 1, r: "Cat", e: "ğŸ˜¼", t: "Great! I can't wait! Alice, this way." },
        { s: 1, r: "Hatter", e: "ğŸ©", t: "Everyone! We are going to jump. Ready!" },
        { s: 1, r: "Card 1", e: "ğŸƒ", t: "Hi! You know. These roses belong to the Queen." },
        { s: 1, r: "Card 2", e: "ğŸƒ", t: "The queen likes red roses!" },
        { s: 1, r: "Cards", e: "ğŸƒ", t: "We have to paint the roses red!" },

        // --- Scene 2: The Fall ---
        { s: 2, r: "Narrator", e: "ğŸ“–", t: "Alice follows the rabbit and falls into a hole." },
        { s: 2, r: "Alice", e: "ğŸ‘±â€â™€ï¸", t: "Whoa! I am falling!" },
        { s: 2, r: "Rabbit", e: "ğŸ°", t: "Watch out everyone! Alice, are you scared?" },
        { s: 2, r: "Alice", e: "ğŸ‘±â€â™€ï¸", t: "Yes~! Help~" },
        { s: 2, r: "Cheshire Cat", e: "ğŸ˜¼", t: "Falling is funny, don't you think?" },
        { s: 2, r: "Alice", e: "ğŸ‘±â€â™€ï¸", t: "No~! I am spinning! Are you spinning too, Hatter?" },
        { s: 2, r: "Hatter", e: "ğŸ©", t: "I like spinning! Don't worry, Just relax." },
        { s: 2, r: "All", e: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦", t: "Ouch! Land~" },
        { s: 2, r: "Card 1", e: "ğŸƒ", t: "Hey you! Don't touch the roses." },
        { s: 2, r: "Card 2", e: "ğŸƒ", t: "Or Queen of Hearts will be mad." },
        { s: 2, r: "Cards", e: "ğŸƒ", t: "The Queen is scary...." },
        { s: 2, r: "All", e: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦", t: "Okay!" }
    ];

    let currentIndex = -1;
    const synth = window.speechSynthesis;
    let voices = [];
    const voiceSelect = document.getElementById('voiceSelect');
    const rateSelect = document.getElementById('rateSelect'); 

    // 1. è¼‰å…¥ä¸¦åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„è²éŸ³ (ä¸¦è¨­å®š Samantha ç‚ºé è¨­)
    function populateVoiceList() {
        voices = synth.getVoices().sort(function (a, b) {
            const aname = a.name.toUpperCase(), bname = b.name.toUpperCase();
            if ( aname < bname ) return -1;
            if ( aname > bname ) return 1;
            return 0;
        });
        
        voiceSelect.innerHTML = '';
        const defaultOption = document.createElement('option');
        defaultOption.textContent = '-- Choose Voice --';
        voiceSelect.appendChild(defaultOption);

        const englishVoices = voices.filter(v => v.lang.includes('en'));
        let samanthaFound = false;

        englishVoices.forEach((voice) => {
            const option = document.createElement('option');
            // ç°¡åŒ–é¡¯ç¤ºåç¨±
            option.textContent = `${voice.name.replace('Microsoft', '').replace('Google', '')}`; 
            option.setAttribute('data-lang', voice.lang);
            option.setAttribute('data-name', voice.name);
            
            // è¨­å®š Samantha ç‚ºé è¨­
            if (voice.name.includes('Samantha')) {
                option.selected = true;
                samanthaFound = true;
            }

            voiceSelect.appendChild(option);
        });

        // å¦‚æœ Samantha æ²’æ‰¾åˆ°ï¼Œå‰‡é¸å–æ¸…å–®ä¸­çš„ç¬¬ä¸€å€‹è‹±æ–‡èªéŸ³ä½œç‚ºé è¨­
        if (!samanthaFound && englishVoices.length > 0) {
             voiceSelect.selectedIndex = 1; // é¸æ“‡ç¬¬ä¸€å€‹æœ‰æ•ˆçš„èªéŸ³ (index 0 æ˜¯ --Choose Voice--)
        }
    }

    populateVoiceList();
    if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = populateVoiceList;
    }

    // 2. æ›´æ–°ç•«é¢é¡¯ç¤º
    function updateDisplay() {
        if (currentIndex < 0) return;
        const line = scriptData[currentIndex];
        
        let sceneName = "";
        if(line.s === 1) sceneName = "Scene 1: Curious Garden";
        else if(line.s === 2) sceneName = "Scene 2: The Rabbit Hole";
        else if(line.s === 3) sceneName = "Scene 3: Down the Hole";
        else sceneName = "Scene 4: The Queen's Rules";

        document.getElementById('scene-title').innerText = sceneName;
        document.getElementById('character-name').innerText = line.r;
        document.getElementById('character-img').innerText = line.e;
        document.getElementById('dialogue').innerText = line.t;

        const stage = document.getElementById('stage');
        stage.className = ''; 
        stage.classList.add('scene-' + line.s);
    }

    // 3. æœ—è®€åŠŸèƒ½ (åŠ å…¥è²éŸ³èˆ‡èªé€Ÿæ§åˆ¶)
    function speakText(text) {
        if (synth.speaking) {
            synth.cancel();
        }
        const utterance = new SpeechSynthesisUtterance(text);
        
        // A. è¨­å®šè²éŸ³
        const selectedOption = voiceSelect.selectedOptions[0];
        if (selectedOption && selectedOption.getAttribute('data-name')) {
            const selectedVoiceName = selectedOption.getAttribute('data-name');
            const selectedVoice = voices.find(v => v.name === selectedVoiceName);
            if (selectedVoice) utterance.voice = selectedVoice;
        } else {
            utterance.lang = 'en-US'; 
        }

        // B. è¨­å®šèªé€Ÿ (å¾é¸å–®è®€å–)
        const selectedRate = parseFloat(rateSelect.value);
        utterance.rate = selectedRate;

        utterance.pitch = 1.1; 
        synth.speak(utterance);
    }

    // 4. æŒ‰éˆ•åŠŸèƒ½
    function nextLine() {
        if (currentIndex < scriptData.length - 1) {
            currentIndex++;
            updateDisplay();
            speakText(scriptData[currentIndex].t);
        }
    }

    function prevLine() {
        if (currentIndex > 0) {
            currentIndex--;
            updateDisplay();
        }
    }

    function replayLine() {
        if (currentIndex >= 0) {
            speakText(scriptData[currentIndex].t);
        }
    }
</script>

</body>
</html>