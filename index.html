<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alice Script - Segmented Audio Playback (S1-S4)</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #fff5e6;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }
        
        #stage {
            width: 90%;
            max-width: 600px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            padding: 30px;
            text-align: center;
            position: relative;
            min-height: 450px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: border-color 0.5s;
            margin-top: 0; 
        }
        
        /* [å…¶ä»–æ¨£å¼ä¿æŒä¸è®Š] */
        #scene-title {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 5px;
            font-weight: bold;
        }
        #character-img {
            font-size: 80px;
            margin: 10px 0;
            animation: bounce 2s infinite;
        }
        #character-name {
            font-size: 1.5rem;
            color: #d63384;
            font-weight: bold;
            margin-bottom: 10px;
        }
        #dialogue {
            font-size: 1.4rem;
            line-height: 1.5;
            color: #333;
            min-height: 100px;
            margin-bottom: 20px;
        }
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr 2fr; 
            gap: 10px;
            margin-top: auto;
        }
        button {
            padding: 15px 10px;
            font-size: 1rem;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: transform 0.1s;
            font-weight: bold;
        }
        button:active { transform: scale(0.95); }
        
        #btn-prev { background-color: #e0e0e0; color: #333; }
        #btn-replay { background-color: #2196F3; color: white; } 
        #btn-next { background-color: #FF9800; color: white; font-size: 1.2rem; }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* Scene Themes (å»¶çºŒèˆŠç‰ˆé…è‰²) */
        .scene-1 { border-top: 10px solid #8bc34a; }
        .scene-2 { border-top: 10px solid #e91e63; }
    </style>
</head>
<body>

<audio id="dialogue-audio" src="alice.m4a"></audio>

<div id="stage" class="scene-1">
    <div id="scene-title">Scene 1: The Garden</div>
    <div id="character-img">ğŸ“–</div>
    <div id="character-name">Narrator</div>
    <div id="dialogue">Click "Next" to start playing the scene.</div>
    
    <div class="controls">
        <button id="btn-prev" onclick="prevLine()">Back</button>
        <button id="btn-replay" onclick="replayLine()">Replay ğŸ”„</button>
        <button id="btn-next" onclick="nextLine()">Next â–¶</button>
    </div>
</div>

<script>
    // åŠ‡æœ¬è³‡æ–™åº« - ç¬¬ 1, 2, 3, 4 å ´æ™¯å…§å®¹ (æ ¹æ“šæ‚¨æä¾›çš„ alice.m4a éŸ³è¨Šå…§å®¹å’Œæ™‚é–“æˆ³è¨˜)
    // start å’Œ end ç‚ºæ™‚é–“æ¨™è¨˜ (ç§’)
    const scriptData = [
        // --- Scene 1: Curious Garden ---
        { s: 1, r: "Narrator", e: "ğŸ“–", t: "Alice is bored in the garden.", start: 0.00, end: 3.2 },
        { s: 1, r: "Alice", e: "ğŸ‘±â€â™€ï¸", t: "Oh, I'm so bored. What can I do?", start: 3.2, end: 8.05 },
        { s: 1, r: "Rabbit", e: "ğŸ°", t: "Oh dear! I'm late. Are you coming?", start: 8.05, end: 13.00 },
        { s: 1, r: "Alice", e: "ğŸ‘±â€â™€ï¸", t: "Me? Wait! Where are you going?", start: 13.00, end: 18.00 },
        { s: 1, r: "Rabbit", e: "ğŸ°", t: "Follow me! Hurry!", start: 18.00, end: 20.2 },
        { s: 1, r: "Alice", e: "ğŸ‘±â€â™€ï¸", t: "Hey, wait.", start: 20.2, end: 24.00 },
        { s: 1, r: "Cat", e: "ğŸ˜¼", t: "Hello. Are you chasing the rabbit?", start: 24.00, end: 28.00 },
        { s: 1, r: "Alice", e: "ğŸ‘±â€â™€ï¸", t: "Yes. Can you help me?", start: 28.00, end: 32.00 },
        { s: 1, r: "Cat", e: "ğŸ˜¼", t: "Maybe. I like fun.", start: 32.00, end: 35.50 },
        { s: 1, r: "Hatter", e: "ğŸ©", t: "Who is late? Tea party is ready!", start: 35.50, end: 40.00 },
        { s: 1, r: "Cat", e: "ğŸ˜¼", t: "Great! I can't wait. Alice, this way.", start: 40.00, end: 45.50 },
        { s: 1, r: "Hatter", e: "ğŸ©", t: "Everyone, we're going to jump. Ready!", start: 45.50, end: 51.00 },
        { s: 1, r: "Card 1", e: "ğŸƒ", t: "Hi daddy mommy. You know, these flowers belong to the Queen.", start: 51.50, end: 60.00 },
        { s: 1, r: "Card 2", e: "ğŸƒ", t: "The Queen likes red roses.", start: 60.00, end: 63.00 },
        { s: 1, r: "Cards", e: "ğŸƒ", t: "We have to paint the roses red.", start: 63.00, end: 67.00 },

        // --- Scene 2: The Rabbit Hole ---
        { s: 2, r: "Narrator", e: "ğŸ“–", t: "Alice followed the rabbit and falls into a hole.", start: 67.00, end: 73.00 },
        { s: 2, r: "Alice", e: "ğŸ‘±â€â™€ï¸", t: "Whoa! I'm falling.", start: 73.00, end: 77.50 },
        { s: 2, r: "Rabbit", e: "ğŸ°", t: "Watch out everyone! Alice, are you scared?", start: 77.50, end: 82.50 },
        { s: 2, r: "Alice", e: "ğŸ‘±â€â™€ï¸", t: "Yes, help.", start: 82.50, end: 85.18 },
        { s: 2, r: "Cheshire Cat", e: "ğŸ˜¼", t: "Falling is funny, don't you think?", start: 85.18, end: 89.80 },
        { s: 2, r: "Alice", e: "ğŸ‘±â€â™€ï¸", t: "No, I am spinning. Are you spinny too, Hatter?", start: 89.80, end: 96.00 },
        { s: 2, r: "Hatter", e: "ğŸ©", t: "I like spinny. Don't worry, just relax.", start: 96.00, end: 102.80 },
        { s: 2, r: "All", e: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦", t: "Ouch! Land!", start: 102.80, end: 106.50 },
        { s: 2, r: "Card 1", e: "ğŸƒ", t: "Hey you, don't touch the roses.", start: 106.50, end: 111.5 },
        { s: 2, r: "Card 2", e: "ğŸƒ", t: "Or the Queen of Hearts will be mad.", start: 111.5, end: 116.00 },
        { s: 2, r: "Cards", e: "ğŸƒ", t: "Oh, the Queen is scary.", start: 116.00, end: 120.00 },
        { s: 2, r: "All", e: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦", t: "Okay, let's go.", start: 120.00, end: 123.00 }
    ];

    let currentIndex = -1;
    const dialogueAudio = document.getElementById('dialogue-audio');
    let stopTimer = null; // ç”¨ä¾†å„²å­˜è¨ˆæ™‚å™¨ï¼Œç¢ºä¿åœæ­¢æº–ç¢º

    // 2. æ›´æ–°ç•«é¢é¡¯ç¤º (èˆ‡å‰ç‰ˆç›¸åŒ)
    function updateDisplay() {
        if (currentIndex < 0) return;
        const line = scriptData[currentIndex];
        
        let sceneName = "";
        if(line.s === 1) sceneName = "Scene 1: The Garden";
        else if(line.s === 2) sceneName = "Scene 2: Red Roses";
        else if(line.s === 3) sceneName = "Scene 3: Down the Hole";
        else if(line.s === 4) sceneName = "Scene 4: The Queen's Rules";
        else sceneName = `Scene ${line.s}: Unknown Scene`; 

        document.getElementById('scene-title').innerText = sceneName;
        document.getElementById('character-name').innerText = line.r;
        document.getElementById('character-img').innerText = line.e;
        document.getElementById('dialogue').innerText = line.t;

        const stage = document.getElementById('stage');
        stage.className = ''; 
        stage.classList.add('scene-' + line.s);
    }

    // 3. æ’­æ”¾éŸ³è¨Šåˆ†æ®µ
    function playSegment(start, end) {
        // 1. æ¸…é™¤èˆŠçš„åœæ­¢è¨ˆæ™‚å™¨
        clearTimeout(stopTimer);
        
        // 2. è¨­ç½®éŸ³è¨Šæ’­æ”¾èµ·å§‹æ™‚é–“
        dialogueAudio.currentTime = start;
        
        // 3. æ’­æ”¾éŸ³è¨Š
        dialogueAudio.play().catch(error => {
            console.error("Audio playback failed:", error);
            alert("ç„¡æ³•æ’­æ”¾éŸ³è¨Šæª”æ¡ˆã€‚è«‹ç¢ºèªæª”æ¡ˆ 'alice.m4a' æ˜¯å¦å­˜åœ¨æ–¼ç›¸åŒç›®éŒ„ä¸­ã€‚");
        });
        
        // 4. è¨­å®šä¸€å€‹å®šæ™‚å™¨ï¼Œåœ¨çµæŸæ™‚é–“åˆ°é”æ™‚åœæ­¢æ’­æ”¾
        const duration = (end - start);
        stopTimer = setTimeout(() => {
            dialogueAudio.pause();
            // å¯é¸ï¼šå°‡ currentTime è¨­ç½®ç‚º startï¼Œæ–¹ä¾¿ä¸‹æ¬¡é‡æ’­
            // dialogueAudio.currentTime = start; 
        }, duration * 1000); // è½‰æ›ç‚ºæ¯«ç§’
    }

    // 4. æŒ‰éˆ•åŠŸèƒ½
    function nextLine() {
        if (currentIndex < scriptData.length - 1) {
            currentIndex++;
            updateDisplay();
            
            const line = scriptData[currentIndex];
            playSegment(line.start, line.end);
        }
    }

    function prevLine() {
        // ç¢ºä¿åœæ­¢ä»»ä½•æ­£åœ¨æ’­æ”¾çš„è²éŸ³
        clearTimeout(stopTimer);
        dialogueAudio.pause();
        dialogueAudio.currentTime = 0; 

        if (currentIndex > 0) {
            currentIndex--;
            updateDisplay();
            // Prev ä¸è‡ªå‹•æ’­æ”¾ï¼Œåªé¡¯ç¤ºæ–‡å­—ï¼Œå¦‚æœéœ€è¦æ’­æ”¾è«‹é» Replay
        }
    }

    function replayLine() {
        if (currentIndex >= 0) {
            const line = scriptData[currentIndex];
            playSegment(line.start, line.end);
        }
    }
</script>

</body>
</html>
